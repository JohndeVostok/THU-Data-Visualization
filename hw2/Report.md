# Homework1 Report

## 问题简述

### 影视数据饼图

使用饼图展现电影的类别占比，并实现交互，给出各个类别的代表性影片。

我的实现中，如果一个电影没有被分类，那么它不会被展现。如果被分到多个类别，他将在每个类别中都占1份。代表性影片选择是评分最高的5部电影。

### 影视数据堆叠柱状图

按照横轴为decade，纵向按种类堆叠，实现影片的堆叠柱状图

在我的实现中，除饼图中的设定外，如果一个电影的年份被缺省，那么它将不被展示。

### 简答

对于数据中的错误问题，本实现中对所有需要用到但是没有数据的例子都予以忽略。而最终样本数没有减少太多，不影响可视化结果。

## 实现

### 设计

实现使用pyecharts实现，pyecharts是百度开源的一个数据可视化库。使用起来简单便捷，但是可定制性较GNUPlot这类通用工具较差，而他丰富的模板类型以及较为容易的交互方式给这一作业带来了很高的便捷性，因此我选择使用pyecharts实现。

pyecharts的另一个好处在于，他的文档是中文的，这在python的库中是不可多得的，毕竟是中国人做的库。但是，其中可能存在一些bug，和文档将的不清楚的地方，设计过程中踩了不少坑。

在饼图设计中，最大的难点在于交互的实现。交互是通过ToolTip实现的，表示的就是鼠标移动到对应的元素时显示的内容。模板中只提供了通过当前元素数据进行交互的模板。如name或value等，而我们想要显示代表电影，就需要另一些设计。

这里pyecharts提供了回调函数的方法。这一点上踩了一个坑，pyecharts本质是生成一个html，因此回调函数只能是JS函数，而文档中没有给出实例，在正常调用python函数的时候又没有报任何错误，因此这个地方花了很多功夫去调，最后发现需要用内置的JSCode方法传入JavaScript代码。这时就有了另一个问题，如何传入数据，之前提到，回调函数的参数只包含数据相关的内容，如name，value。因此我们需要提前给网页传入代表电影等数据。

我提前生成了代表电影列表的JSON，然后通过add_js_func的方式执行JS中的json.parse将数据hardcode进浏览器。而这个过程中，由于标题本身会带有单引号和双引号等字符，导致转化过程总会出现一些问题。因此我在预处理阶段将单双引号转化为"*"和"+"，再在读取过程中替换回引号。而JSCode的实现中存在bug，导致转义字符的处理存在一些问题，在浏览器中浏览的JS代码生成错误，会有一些"\"没有被正确转义。而经过对文档的研究，pyecharts中tooltip显示的内容，实际是HTML标准的，因此可以被替换为HTML转义符"&quot"，"&apos"。这个问题就解决掉了，实际这一段文档有误，文档中提出返回值应当为以"\n"换行的字符串，实际这种方式不行，只能用HTML的"\<br\>"。

饼图本身没有任何难度，至此饼图设计完成。

堆积柱状图也比较容易，因为纵向堆积是按照类别进行的，因此我们按照类别分类，类别内按照年代划分。在数据图中，每次添加的时候添加一个类别，并设置好堆叠方向即可。没有过多难点。

### 使用方法

安装 Requirement

pyecharts: version > 1.0.0

这里需要提一句，pyecharts在1.0的时候进行了一次重构，网上大部分教程都是基于老版本的，甚至直接搜索pyecharts的文档给的都是老版本的文档。可以从github上直接访问新版本文档。

``` shell
pip install pyecharts --user
```

准备数据集

这一步主要是进行数据的清洗和格式整理。

``` shell
mv imdb.csv hw2/.
cd hw2
python format.py
```

生成饼图
生成后直接访问pie.html即可，鼠标移动到饼图对应的地方会显示当前类别评分最高的五部电影。实际想加图进去，只要用js代码调用就可以了，但是手动搞这么多张图实在有点麻烦，懒得做了。

``` shell
python plot_pie.py
```

生成堆积柱状图
生成后访问hist.html即可

``` shell
python plot_hist.py
```

## 总结

这个实验让我复习了JavaScript的很多知识，并且学会了一个新的python数据可视化框架。总体来说收获颇丰。
